<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Подключение c Font Face Observer </title>

  <link rel="stylesheet" href="css/style.min.css">
  <link rel="stylesheet" href="css/font-face-only.css">
  <link rel="stylesheet" href="css/font-fontfaceobserver.css">

  <script>
  (function() {

    // Если полнят флаг загруженности шрифтов
    if( sessionStorage.ffoBaseFontsLoaded ) {
      document.documentElement.className += " base-fonts-loaded";
      console.log('Найден флаг наличия шрифтов в кеше, просто добавляем класс.');
      return;
    }

    // FontFaceObserver https://github.com/bramstein/fontfaceobserver
    (function(){function e(e,t){document.addEventListener?e.addEventListener("scroll",t,!1):e.attachEvent("scroll",t)}function t(e){document.body?e():document.addEventListener?document.addEventListener("DOMContentLoaded",function t(){document.removeEventListener("DOMContentLoaded",t),e()}):document.attachEvent("onreadystatechange",function n(){if("interactive"==document.readyState||"complete"==document.readyState)document.detachEvent("onreadystatechange",n),e()})}function n(e){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(e)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.f=document.createElement("span"),this.g=-1,this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function r(e,t){e.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;left:-999px;white-space:nowrap;font:"+t+";"}function i(e){var t=e.a.offsetWidth,n=t+100;return e.f.style.width=n+"px",e.c.scrollLeft=n,e.b.scrollLeft=e.b.scrollWidth+100,e.g!==t?(e.g=t,!0):!1}function s(t,n){function r(){var e=s;i(e)&&null!==e.a.parentNode&&n(e.g)}var s=t;e(t.b,r),e(t.c,r),i(t)}function o(e,t){var n=t||{};this.family=e,this.style=n.style||"normal",this.weight=n.weight||"normal",this.stretch=n.stretch||"normal"}function l(){if(null===a){var e=document.createElement("div");try{e.style.font="condensed 100px sans-serif"}catch(t){}a=""!==e.style.font}return a}function c(e,t){return[e.style,e.weight,l()?e.stretch:"","100px",t].join(" ")}var u=null,a=null,f=null;o.prototype.load=function(e,i){var o=this,a=e||"BESbswy",l=i||3e3,h=(new Date).getTime();return new Promise(function(e,i){null===f&&(f=!!window.FontFace);if(f){var p=new Promise(function(e,t){function n(){(new Date).getTime()-h>=l?t():document.fonts.load(c(o,o.family),a).then(function(t){1<=t.length?e():setTimeout(n,25)},function(){t()})}n()}),d=new Promise(function(e,t){setTimeout(t,l)});Promise.race([d,p]).then(function(){e(o)},function(){i(o)})}else t(function(){function t(){var t;if(t=-1!=m&&-1!=g||-1!=m&&-1!=S||-1!=g&&-1!=S)(t=m!=g&&m!=S&&g!=S)||(null===u&&(t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),u=!!t&&(536>parseInt(t[1],10)||536===parseInt(t[1],10)&&11>=parseInt(t[2],10))),t=u&&(m==x&&g==x&&S==x||m==T&&g==T&&S==T||m==N&&g==N&&S==N)),t=!t;t&&(null!==C.parentNode&&C.parentNode.removeChild(C),clearTimeout(L),e(o))}function f(){if((new Date).getTime()-h>=l)null!==C.parentNode&&C.parentNode.removeChild(C),i(o);else{var e=document.hidden;if(!0===e||void 0===e)m=p.a.offsetWidth,g=d.a.offsetWidth,S=v.a.offsetWidth,t();L=setTimeout(f,50)}}var p=new n(a),d=new n(a),v=new n(a),m=-1,g=-1,S=-1,x=-1,T=-1,N=-1,C=document.createElement("div"),L=0;C.dir="ltr",r(p,c(o,"sans-serif")),r(d,c(o,"serif")),r(v,c(o,"monospace")),C.appendChild(p.a),C.appendChild(d.a),C.appendChild(v.a),document.body.appendChild(C),x=p.a.offsetWidth,T=d.a.offsetWidth,N=v.a.offsetWidth,f(),s(p,function(e){m=e,t()}),r(p,c(o,'"'+o.family+'",sans-serif')),s(d,function(e){g=e,t()}),r(d,c(o,'"'+o.family+'",serif')),s(v,function(e){S=e,t()}),r(v,c(o,'"'+o.family+'",monospace'))})})},"undefined"!=typeof module?module.exports=o:(window.FontFaceObserver=o,window.FontFaceObserver.prototype.load=o.prototype.load)})();

    // Базовые шрифты
    var MerriweatherBold = new FontFaceObserver('Merriweather_circle', { weight: 700 });
    var Rubik = new FontFaceObserver('Rubik_kubik', { weight: 400 });

    // Следим за загрузкой (стандартный вариант)
    // Promise.all([
    //   MerriweatherBold.load(),
    //   Rubik.load(),
    // ]).then(function () {
    //   document.documentElement.className += " base-fonts-loaded";
    //   console.log('Базовые шрифты загружены, добавляем класс и поднимаем флаг');
    //   // Поднимаем флаг загруженности
    //   sessionStorage.ffoBaseFontsLoaded = true;
    // });

    // Следим за загрузкой с таймером прерывания
    Promise.race([
      timer(2000),
      MerriweatherBold.load(),
      Rubik.load(),
    ]).then(function () {
      document.documentElement.className += " base-fonts-loaded";
      console.log('Базовые шрифты загружены, добавляем класс и поднимаем флаг');
      // Поднимаем флаг загруженности
      sessionStorage.ffoBaseFontsLoaded = true;
    }).catch(function () {
      console.log('Время на загрузку истекло, загрузка прервана');
    });

    // Таймер, прерывающий загрузку
    function timer(time) {
      return new Promise(function (resolve, reject) {
        setTimeout(reject, time);
      });
    }

  })();
  </script>

</head>
<body>

  <nav class="main-nav">
    <ul class="main-nav__list">
      <li><a href="index_from-google.html">Подключение с fonts.google.com</a></li>
      <li><a href="index_from-google_2.html">Подключение с fonts.google.com (опт. набор символов)</a></li>
      <li><a href="index.html">@font-face</a></li>
      <li><a href="index_font-display.html">@font-face с font-display</a></li>
      <li><a href="index_preload.html">@font-face и Preload</a></li>
      <li><a href="index_font-css.html">Шрифты в CSS (отдельный файл c WOFF)</a></li>
      <li><a href="index_font-css2.html">Шрифты в CSS (отдельный файл c WOFF2)</a></li>
      <li><a href="index_font-css_include.html">Шрифты в CSS вставлены в разметку</a></li>
      <li><a href="index_font-base64-ls.html">Кеширование в LS</a></li>
      <li><a href="index_webfontloader-local.html">Web Font Loader (локальные файлы шрифта)</a></li>
      <li><a href="index_from-google_3.html">Web Font Loader (шрифты с fonts.google.com)</a></li>
      <li><a href="index_font-face-observer.html">Font Face Observer (FOUT)</a></li>
      <li><a href="index_font-face-observer-2.html">Font Face Observer (FOIT)</a></li>
      <li><a href="index_font-loading-api.html">CSS Font Loading API</a></li>
    </ul>
    <ul class="main-nav__list">
      <li><a href="index_icon-font.html">Иконочный шрифт (FA)</a></li>
      <li><a href="index_icon-font-fontello.html">Иконочный шрифт (fontello, встроен)</a></li>
      <li><a href="index_icon-font-fontello-2.html">Иконочный шрифт (fontello, внешние файлы)</a></li>
      <li><a href="index_icon-svg-in.html">SVG-иконки (спрайт в разметке)</a></li>
      <li><a href="index_icon-svg.html">SVG-иконки (спрайт кешируется в localStorage)</a></li>
    </ul>
    <a href="https://github.com/nicothin/workshop_fonts_icons">Репозиторий</a>, <a href="https://nicothin.github.io/workshop_fonts_icons/">демка на github</a>
  </nav>


  <p class="descr">Подключение c Font Face Observer (два базовых шрифта, совместная проверка, FOUT)</p>

  <h1>Тестовый стенд</h1>


  <h2>Заголовок header</h2>

  <img src="img/image.jpg" alt="" class="demo-image">

  <p>Далеко-далеко за словесными горами в стране, гласных и согласных живут рыбные тексты. Своего дал алфавит заманивший, переписали коварных.</p>
  <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repudiandae, voluptatibus ut minus necessitatibus saepe laborum optio.</p>
  <p>Далеко-далеко за словесными горами в стране, гласных и согласных живут рыбные тексты. Своего дал алфавит заманивший, переписали коварных.</p>

  <p>!"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~¨©«®´¸»ˆ˚˜ЁАБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдежзийклмнопрстуфхцчшщъыьэюяё–—…‹›€™</p>
  <table class="demo-table">
    <tr>
      <th>Что</th>
      <th>Как</th>
    </tr>
    <tr>
      <td><span class="safe-text">light</span></td>
      <td>
        <span class="weight-300">Лёгкий текст. Light text.</span><br>
        <span class="weight-300  italic">Лёгкий текст. Light text.</span>
      </td>
    </tr>
    <tr>
      <td><span class="safe-text">regular</span></td>
      <td>
        <span class="weight-400">Нормальный текст. Regular text.</span><br>
        <span class="weight-400  italic">Нормальный текст. Regular text.</span>
      </td>
    </tr>
    <tr>
      <td><span class="safe-text">bold</span></td>
      <td>
        <span class="weight-700">Полужирный текст. Bold text.</span><br>
        <span class="weight-700  italic">Полужирный текст. Bold text.</span>
      </td>
    </tr>
  </table>

  <table class="demo-table  demo-table--serif">
    <tr>
      <th>Что</th>
      <th>Как</th>
    </tr>
    <tr>
      <td><span class="safe-text">light</span></td>
      <td>
        <span class="weight-300">Лёгкий текст. Light text.</span><br>
        <span class="weight-300  italic">Лёгкий текст. Light text.</span>
      </td>
    </tr>
    <tr>
      <td><span class="safe-text">regular</span></td>
      <td>
        <span class="weight-400">Нормальный текст. Regular text.</span><br>
        <span class="weight-400  italic">Нормальный текст. Regular text.</span>
      </td>
    </tr>
    <tr>
      <td><span class="safe-text">bold</span></td>
      <td>
        <span class="weight-700">Полужирный текст. Bold text.</span><br>
        <span class="weight-700  italic">Полужирный текст. Bold text.</span>
      </td>
    </tr>
  </table>


  <p>Снова мир всемогущая, языком великий заголовок запятой его власти, рыбного последний текст, текста безорфографичный обеспечивает оксмокс.</p>
  <p>Ratione voluptates praesentium, earum quisquam. Animi dolorum enim quidem quae fugiat porro voluptate dolorem repellat accusantium.</p>

  <h2>Заголовок header</h2>

  <img src="img/image.jpg" alt="" class="demo-image">

  <p>Далеко-далеко за словесными горами в стране, гласных и согласных живут рыбные тексты. Своего дал алфавит заманивший, переписали коварных.</p>
  <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repudiandae, voluptatibus ut minus necessitatibus saepe laborum optio.</p>
  <p>Далеко-далеко за словесными горами в стране, гласных и согласных живут рыбные тексты. Своего дал алфавит заманивший, переписали коварных.</p>
  <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repudiandae, voluptatibus ut minus necessitatibus saepe laborum optio.</p>
  <p>Далеко-далеко за словесными горами в стране, гласных и согласных живут рыбные тексты. Своего дал алфавит заманивший, переписали коварных.</p>
  <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repudiandae, voluptatibus ut minus necessitatibus saepe laborum optio.</p>

  <h2>Заголовок header</h2>

  <img src="img/image.jpg" alt="" class="demo-image">

  <p>Далеко-далеко за словесными горами в стране, гласных и согласных живут рыбные тексты. Своего дал алфавит заманивший, переписали коварных.</p>
  <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repudiandae, voluptatibus ut minus necessitatibus saepe laborum optio.</p>
  <p>Далеко-далеко за словесными горами в стране, гласных и согласных живут рыбные тексты. Своего дал алфавит заманивший, переписали коварных.</p>
  <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repudiandae, voluptatibus ut minus necessitatibus saepe laborum optio.</p>
  <p>Далеко-далеко за словесными горами в стране, гласных и согласных живут рыбные тексты. Своего дал алфавит заманивший, переписали коварных.</p>
  <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repudiandae, voluptatibus ut minus necessitatibus saepe laborum optio.</p>

</body>
</html>
